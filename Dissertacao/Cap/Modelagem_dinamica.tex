\pagestyle{empty}
\cleardoublepage
\pagestyle{fancy}

\chapter{Modelagem Dinâmica e Controlador} \label{Cap:Modelagem:Dinamica}

 Nesse capítulo abordaremos a modelagem dinâmica do rotor que sofre influências das forças do estator externo e dos polos do estator interno. Um modelo linearizado no ponto de operação é apresentando para o projeto do controlador.
 
\section{Modelagem}

A dinâmica do rotor é influenciada basicamente pela sua velocidade de rotação ($\dot{\theta}$), sua inércia ($I$), massa ($m$) e posição relativa do rotor ($d_x,d_y,d_z$) compondo a energia cinética ($T$) do sistema. A parcela da energia potência ($V$) dar-se pela  sua translação axial ($d_z$), pela gravidade ($g$) e pela rigidez passiva do mancal ($K_z$) calculada na Sec. \ref{}. A Fig. \ref{fig:modelo:forcas} ilustra as forças atuantes no rotor, sendo :

 \begin{itemize}
 	\item $F_p$ : Força devido ao imã permanente
 	\item $F_b$ : Força devido a bobina
 	\item $\tau$ : Torque de rotação devido ao motor
 	\item $\theta$ : O angulo do rotor
 	\item $x,y,z$ : Deslocamento no plano cartesiano 
 \end{itemize}

 \begin{figure}[th]
 	\centering
 	\includegraphics[width=0.7\linewidth]{../Figs/Modelagem/forcas}
 	\caption{Forças atuantes rotor}
 	\label{fig:modelo:forcas}
 \end{figure}
 
 \begin{align}
 	T_{\theta, x, y, z} &= \frac{1}{2} I_z \, \dot{\theta}^2 + \frac{1}{2} \, m \, \left( \dot{x}^2 + \dot{y}^2 + \dot{z}^2 \right) \notag \\
 	V_z &= m \, g \, z + \frac{1}{2} \, K_z \, z^2
 \end{align}	
 	
 Duas forças distintas agem no rotor: a primeira, não conservativa ($Q^{nc}$) é causada pela força de atração ($F_b$) nos atuadores, é dependente da posição do rotor e da corrente aplicada ($i$); a segunda, conservativa ($Q^{c}$) é dependente somente da posição do rotor e é causada pela força de atração dos ímãs, podendo ser traduzida para uma rigidez ($K_p$). Ambas as forças $F_b$ e $K_p$ são levantadas via o modelo de elementos finitos. 
	 	
 \begin{align}
 	Q_y^{nc} &= F_{by}(d_x,i)  \\
 	Q_x^{nc} &= F_{bx}(d_y,i)  \\
 	Q^{c}_x  &= K_p \, d_x \\
 	Q^{c}_y  &= K_p \, d_y 
 \end{align}
  
  Com a resolução da lagrangiana (Eq. \ref{eq:dinamica:lagrangiana}) obtemos as equações da dinâmica (Eq. \ref{eq:dinamica:modelo}) do sistema:
  
   \begin{align}
   		L = T - V \notag \\
   		\frac{\partial}{\partial t} \left[ \frac{\partial L}{\partial \dot{r}} \right] -  \frac{\partial L}{\partial r} = Q^{nc} + Q^{c}
   		\label{eq:dinamica:lagrangiana}
   \end{align}
  
 	\begin{align}
 	I \ddot{\theta} &= 0 \\
 	m \ddot{x}		&= K_p \, d_x  - F_{bx}(dx,i) \\
 	m \ddot{y}		&= K_p \, d_y  - F_{by}(dy,i) \label{eq:dinamica:rotor:radial}\\	
 	m \ddot{z}  	&= K_z \, d_z + m g 
 	\label{eq:dinamica:modelo}
 	\end{align}	
 
 Exceto pela dependência das posições nas forças, verificamos pelas equações o desacoplamento entre os diferentes graus de liberdade. 

\subsection{Rigidez Passiva : $K_p$}

A força exercida no rotor devido aos imãs permanentes do estator externo podem ser aproximadas por uma equação linear, como visto em \ref{subsection:forca:x}. Assumisse que a força de atração no roto para pequenos deslocamento dependa somente da posição no eixo, podendo ser representada pela decomposição:

\begin{align}
	F_p(x) &= K_p \, x \\
	F_p(y) &= K_p \, y 
\end{align}

Onde $K_p$ é a constante de proporção entre a força e a posição, x e y são os deslocamento em torno do ponto de equilibro do rotor com relação ao estator externo. Obtemos via a simulação em elementos finitos um relação força por deslocamento para ambos os eixos (devido a simetria do mancal). 

\begin{equation}
 K_p(d) = 625 N/mm 
\end{equation}

\subsection{Rigidez Ativa : $F_b$}

A força de atração do rotor devido ao campo magnético gerado pelas bobinas é não linear com a posição do rotor (comprimento do entreferro) e depende da corrente de excitação aplicada as bobinas.  

As tensões nas bobinas são distribuídas conforme Fig. \ref{fig:blocos:tensao:bobinas:x:y} (a), onde existe sobreposição de bobinas para atuação em diferentes eixos (X e Y). É aplicado nas bobinas que possuem sobreposição a metade da tensão, limitando assim o valor da tensão total nas bobinas para o valor máximo (I/2 + I/2 = I). A Fig. \ref{fig:blocos:tensao:bobinas:x:y} ilustra a configuração proposta. Verificamos que a tensão é aplicada em metade para as bobinas com sobreposição (a,g,e,c) e com ganho unitário nas bobinas principais (h,f,c,b). 

\begin{figure}[th]
\centering
\includegraphics[width=0.7\linewidth]{./Figs/Modelagem/ativo-atuadores-conexao}
\caption{Distribuição das tensões nas bobinas}
\label{fig:blocos:tensao:bobinas:x:y}
\end{figure}

A força aplicada no rotor é levantada via resultados da modelagem em elementos
finitos, um polinômio de segundo grau com confidência de 95\% foi encontrado
(Eq. \ref{eq:fb:segundo:grau}) via curva da Fig.
\ref{ativo_otimizado_fem_I_dx00}.

\begin{equation}
     F_b(i) = -0.6777 \, i^2 + -55.5 \, i + 16.69
     \label{eq:fb:segundo:grau}
\end{equation}

Para o polo operando com a corrente entre 0 e 2 Amperes, podemos descrever uma equação linear que representa a força de atração. 

\begin{equation}
     F_b(i) = -10.21 \, i 
     \label{eq:fb:primeiro:grau}
\end{equation}

\subsection{Dinâmica Atuador}

Devido as bobinas dos polos do estator interno, uma dinâmica do atuador ($G_a(s)$) atrelada a indutância deve ser considerada. A bobina é modelada como um circuito RL, com a dinâmica descrita na Eq. \eqref{eq:dinamica:bobina}.

\begin{align}
	I(s) &= \frac{V(s)}{R + L \, s} 
	\label{eq:dinamica:bobina}
\end{align}

Os valores das indutâncias são calculadas como demonstrada na SubSec. \ref{subsec:at:indutancia}. Os valores nominais no ponto de operação de cada bobina é de $0.194$ H e a sua resistência elétrica de 6.3 $\Omega$ gerando uma frequência de corte de 11 Hz. 

\begin{table}[ht!]
	\centering
	\begin{tabular}{c c c}
        L [H]  & $d_x$ [mm] & I [A] \\
        \hline \hline
        0.234   & 0    & 4 \\
        0.224	& 0.3  & 4			
	\end{tabular} 
	\caption{Indutâncias calculadas para diversos pontos de operação via elementos finitos}
	\label{tab:dinamica:indutancia} 
\end{table} \todo{verificar calculo da indutancia}

\subsection{Batente}

O batente atua como uma saturação na posição do rotor (x,y, z), atrelou-se uma dinâmica ao batente para analisar as influências de choques mecânicos do rotor, possibilitando a analise de fadigas e a especificação de componentes de fixação (parafusos) . Utilizou-se no  modelo o módulo de elasticidade de Young, onde a penetração ($\Delta l $) no material pode ser calculada por :

\begin{equation}
	\Delta l =  \frac{F l_o}{E \, A}
\end{equation}

Sendo : \textbf{E }a constante de Yomg para o material; \textbf{A} área de contato; \textbf{$l_o$ } o comprimento inicial do material e \textbf{F} a força resultante do impacto. 


\subsection{Modelo Linear}

O modelo linear ($G_{ma}$) de malha aberta para um dos eixos de movimentação no plano x,y (radial) é levantado em torno do equilíbrio do rotor, considera-se as dinâmicas do rotor ($G_r$) e do atuador ($G_a$) deduzido das equações  \eqref{eq:dinamica:rotor:radial} e \eqref{eq:dinamica:bobina}.

\begin{align}
	G_r &= \frac{1}{s^2 \, m - K_p} \\
	G_a &= \frac{K_b}{s\, L + R}
\end{align}

O modelo encontrado é utilizado para o projeto do controlador ($C(s)$), esse otimizado para operar em torno do ponto de operação (rotor). A função transferência do modelo obtido é demonstrado na Eq. \eqref{eq:dinamica:tfunc:gen}, o sistema obtido possui três polos sendo eles nenhum integrador puro (sistema tipo 0).  

\begin{align}
	G_{ma}(s) &= \frac{K_b}{(s^2 \, m - K_p) \, (s\, L + R)}	\label{eq:dinamica:tfunc:gen} \\
	&= \frac{10}{(s^2 \, 0.375 - 625) \, (s\, 0.194 + 4)}
	 \label{eq:dinamica:tfunc}
\end{align}
 

Os três polos estão localizado em: $[-40 -26 +40]$ , onde a função de transferência é descrita na Eq. \eqref{eq:dinamica:tfunc}, os parâmetros utilizados foram encontrados nas secções anteriores. 

%Verificamos através da analise em frequência (Fig. \ref{fig:bode:rlocus:pnt:operacao}) que o sistema é instável em malha aberta e um controlador deve ser projetado para estabilizar o sistema. 

%Para fins de análise e comparação, os polos do sistema para o rotor em seu deslocamento máximo estão localizados em : $[-40 -20 +40]$

%\begin{figure}[!ht]
%	\centering
%	\subfloat[t][Lugar das raizes]{
%	\includegraphics[width=0.6\linewidth]{Figs/Simulacoes/Dinamica/rlocus:pnt:operacao}
%	}\\
%	%
%	\subfloat[b][Diagrama de Bode]{
%	\includegraphics[width=0.6\linewidth]{Figs/Simulacoes/Dinamica/bode:pnt:operacao}
%	}	
%	
%	\caption{Analise em frequência do sistema obtido}
%	\label{fig:bode:rlocus:pnt:operacao}
%\end{figure}

\subsection{Modelo Dinâmico Não Linear}

Um modelo dinâmico não linear foi projetado em ambiente Matlab Simulink para a validação do controlador, esse modelo, leva em consideração as modelagens eletromagnéticas realizadas para a otimização do mancal.

A Fig. \ref{diagrama:blocos:modelo:linear} demonstra o diagrama de blocos propostos, sendo $C_s$ o controlador projetado. Nesse esquema, o controlador age diretamente nas bobinas aplicando a corrente necessária para estabilizar o rotor no ponto de operação. 

\begin{figure}[th!]
	\centering
	\includegraphics[width=1\linewidth]{../Figs/Modelagem/diagrama_blocos_modelo_linear}
	\caption{Diagrama de blocos do modelo linearizado para descolamentos em x e y}
	\label{fig:diagrama:blocos:modelo:linear}
\end{figure}

\todo[inline]{demosntrar como foi implementado cada bloco ?}

\section{Projeto do Controlador}

Um controlador é projetado a fim de demonstrar a controlabilidade do sistema proposto dentro das especificações impostas ao mancal. O projeto do controlador é feito via modelo linear e validado utilizando o modelo não linear. 

O controlador age diretamente sob a posição do rotor no plano x,y através de duas forças ortogonais: $F_{bx}$ e $F_{by}$. A corrente necessária para gerar essas forças é calculada via um estimador de corrente, que traduz a força em uma corrente levando em consideração a posição do mancal.

\subsection{Estimador}
	
A fim de superar as não linearidades no ganho do atuador ($Kb(d,i)$, um controle de força é projetado no lugar do de corrente. A força calculada pelo controle é aplicada em um estimador que calcula a corrente necessária a ser aplicada na bobina com base na posição do rotor. Figura \ref{fig:diagrama_controlador_estimador} ilustra o estimador de corrente proposto, que é dependente da área do polo ($S_n$) do comprimento do entreferro ($l_g$), do número de espirar ($n_n$). O equacionamento (Eq. \eqref{eq:estimator:i}) é obtido através de um modelo simplificado da equação de força magnética considerando apenas um entreferro e um componente ferromagnético.

%\begin{align}
%F_b &= \frac{B_g^2 \m S_n}{2\, \mu_0} \\
%H_g \mu_0 &= B_g 
%\end{align}
	
\begin{equation}
I = \sqrt{\frac{2 \, F_b \, \mu_0}{S_n(l_g)}} \, \frac{\mu_0 \, S_n(l_g)^2}{n_n}
\label{eq:estimator:i}
\end{equation}
	
\begin{figure}[ht!]
	\centering
	\includegraphics[width=0.5\linewidth]{Figs/Modelagem/controlador_estimador}
	\caption{Diagrama de blocos do controlador e estimador}
	\label{fig:diagrama_controlador_estimador}
\end{figure}

\subsubsection{Controlador}

O controle projetado para o mancal magnético proposto utiliza a técnica de controle ótimo 

%\section{Simulações}
%
%Simulações foram realizadas em malha aberta com o modelo não linear das forças,  a Fig. \ref{fig:dinamica:choque:rotor} é o comportamento do rotor quando nenhuma corrente é aplicada nos polos, verificamos  o choque com o batente em torno do 5ms.
%
%\begin{figure}[th!]
%\centering
%\caption*{Posição x,y (mm) do rotor ao longo do tempo (s)}
%\includegraphics[width=0.7\linewidth]{./Modelagem/dinamica_choque_rotor}
%\caption{Dinâmica instável do rotor e choque no batente}
%\label{fig:dinamica:choque:rotor}
%\end{figure}
%
%A Fig. \ref{fig:dinamica:corrente:rotor} mostra o deslocamento do rotor dado a aplicação de 2.5 V nas bobinas x+,  verificamos a dinâmica da corrente dado a aplicação da corrente.
%
%\begin{figure}[th!]
%\centering
%\includegraphics[width=0.7\linewidth]{./Modelagem/dinamica_corrente_rotor.pdf}
%\caption{Dinâmica do rotor dado a aplicação de tensão na bobina X+}
%\label{fig:dinamica:corrente:rotor}
%\end{figure}
%
